#include <iostream>
#include <stack>
using namespace std;

// Node structure for Expression Tree
struct Node {
    char data;
    Node *left, *right;

    Node(char val) {
        data = val;
        left = right = nullptr;
    }
};

// Function to construct expression tree from prefix expression
Node* constructTree(string prefix) {
    stack<Node*> st;
    
    for (int i = prefix.length() - 1; i >= 0; i--) {
        char ch = prefix[i];
        Node* node = new Node(ch);

        if (isalpha(ch)) {
            st.push(node); // Push operand
        } else {
            // Operator node: Pop two nodes and attach them
            node->left = st.top(); st.pop();
            node->right = st.top(); st.pop();
            st.push(node);
        }
    }
    return st.top();
}

// Non-recursive post-order traversal
void postOrderTraversal(Node* root) {
    if (!root) return;

    stack<Node*> s1, s2;
    s1.push(root);

    while (!s1.empty()) {
        Node* node = s1.top();
        s1.pop();
        s2.push(node);

        if (node->left) s1.push(node->left);
        if (node->right) s1.push(node->right);
    }

    while (!s2.empty()) {
        cout << s2.top()->data << " ";
        s2.pop();
    }
}

// Function to delete the entire tree
void deleteTree(Node* &root) {
    if (!root) return;

    stack<Node*> s;
    s.push(root);

    while (!s.empty()) {
        Node* node = s.top();
        s.pop();

        if (node->left) s.push(node->left);
        if (node->right) s.push(node->right);

        delete node;
    }
    root = nullptr;
}

int main() {
    string prefix = "+--a*bc/def";
    
    // Step 1: Construct expression tree
    Node* root = constructTree(prefix);
    
    // Step 2: Non-recursive Post-order traversal
    cout << "Post-order Traversal: ";
    postOrderTraversal(root);
    cout << endl;

    // Step 3: Delete the tree
    deleteTree(root);

    if (!root)
        cout << "Tree deleted successfully!" << endl;

    return 0;
}
